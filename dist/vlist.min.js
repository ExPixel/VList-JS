var VList;
(function (VList_1) {
    var VListData = (function () {
        function VListData() {
        }
        return VListData;
    }());
    var VListBuffer = (function () {
        function VListBuffer(off) {
            if (off === void 0) { off = 0; }
            this.off = off;
            this.renderedElements = 0;
            this.elements = [];
            this.container = document.createElement('div');
            this.container.style.margin = "0";
            this.container.style.padding = "0";
        }
        VListBuffer.prototype.moveTo = function (y) {
            this.y = y;
            this.container.style.transform = "translateY(" + (y - this.off) + "px)";
        };
        VListBuffer.prototype.setRenderLength = function (l) {
            this.renderLength = l;
            if (this.elements.length > l) {
                var idx = l, len = this.elements.length;
                for (idx; idx < len; idx++) {
                    var element = this.elements[idx];
                    if (element) {
                        element.remove();
                    }
                }
                this.elements.splice(l, this.elements.length - l);
                if (this.elementTemplates && this.elementTemplates.length > this.elements.length) {
                    this.elementTemplates.splice(this.elements.length, this.elementTemplates.length - this.elements.length);
                }
            }
        };
        return VListBuffer;
    }());
    var VList = (function () {
        function VList(options) {
            var _this = this;
            this.buffer0 = new VListBuffer();
            this.buffer1 = new VListBuffer();
            this._length = 0;
            this.bufferHeight = 0;
            this.data = new VListData();
            this.elementCreator = document.createElement('div');
            console.log(options);
            if (options.templateRender && !options.template)
                throw Error("A template string must be provided when also providing a template render function.");
            if (options.templateRender && options.render)
                throw Error("A normal render function cannot be passed alongside a template render function.");
            if (options.template && !options.templateRender)
                throw Error("A template render function must be provided when also providing a template string.");
            if (typeof options.container === "string") {
                this.data.container = document.querySelector(options.container);
            }
            else {
                this.data.container = options.container;
            }
            this.data.elementHeight = options.elementHeight;
            this.data.render = options.render;
            this.data.template = options.template;
            this.data.templateRender = options.templateRender;
            this.data.onCreateElement = options.onCreateElement;
            if (this.data.template) {
                this.buffer0.elementTemplates = [];
                this.buffer1.elementTemplates = [];
                this.templateMode = true;
                this.compileTemplate();
            }
            this.buffer0.name = "buf0";
            this.buffer1.name = "buf1";
            this.viewportSizeChanged();
            this.setContainerHeight();
            this.data.container.parentElement.addEventListener('scroll', function () {
                _this.scrollPositionChanged();
            });
            this.data.container.appendChild(this.buffer0.container);
            this.data.container.appendChild(this.buffer1.container);
            this.buffer1.off = this.bufferHeight;
        }
        VList.prototype.setContainerHeight = function () {
            this.data.container.style.height = Math.ceil(this.data.elementHeight * this._length) + "px";
        };
        VList.prototype.viewportSizeChanged = function () {
            var style = window.getComputedStyle(this.data.container.parentElement, null);
            var height = parseInt(style.getPropertyValue('height'));
            var renderLength = Math.ceil(height / this.data.elementHeight) * 2;
            this.buffer0.setRenderLength(renderLength);
            this.buffer1.setRenderLength(renderLength);
            this.bufferHeight = height * 2;
            this.render(true);
        };
        VList.prototype.scrollPositionChanged = function () {
            this.render(false);
        };
        VList.prototype.compileTemplate = function () {
            var _this = this;
            var _createNode = document.createElement('div');
            _createNode.innerHTML = this.data.template;
            if (_createNode.firstElementChild && _createNode.firstElementChild.nextElementSibling) {
                throw Error("Templates must have a single top level element.");
            }
            this.templateBindingInfo = {};
            var process = function (node, parents, current) {
                var attr = node.getAttribute('vlist-name');
                if (attr) {
                    var temp = parents.slice(0);
                    temp.push(current);
                    _this.templateBindingInfo[attr] = temp;
                }
            };
            process(_createNode, [], 0);
            var visit;
            visit = function (node, parents) {
                var siblingIdx = 0;
                do {
                    process(node, parents, siblingIdx);
                    if (node.firstElementChild) {
                        parents.push(siblingIdx);
                        visit(node.firstElementChild, parents);
                        parents.pop();
                    }
                    siblingIdx++;
                    node = node.nextElementSibling;
                } while (node);
            };
            visit(_createNode.firstElementChild, []);
        };
        VList.prototype.inserted = function (startIndex, length) {
            if (length === void 0) { length = 1; }
            var rel = this.indexPositionRelativeToBuffers(startIndex, length);
            this.length += length;
            switch (rel) {
                case 1: break;
                case 0:
                    this.shiftBufferPositions(length * this.data.elementHeight);
                    break;
                default:
                    this.render(true);
                    break;
            }
        };
        VList.prototype.changed = function (startIndex, length) {
            length = Math.min(this.length, length);
            var rel = this.indexPositionRelativeToBuffers(startIndex, length);
            if (rel === 2) {
                this.render(true);
            }
        };
        VList.prototype.removed = function (startIndex, length) {
            if (length === void 0) { length = 1; }
            length = Math.min(this.length, length);
            var rel = this.indexPositionRelativeToBuffers(startIndex, length);
            this.length -= length;
            switch (rel) {
                case 1: break;
                case 0:
                    this.shiftBufferPositions(-1 * length * this.data.elementHeight);
                    break;
                default:
                    this.render(true);
                    break;
            }
        };
        VList.prototype.shiftBufferPositions = function (shiftBy) {
            this.buffer0.moveTo(this.buffer0.y + shiftBy);
            this.buffer1.moveTo(this.buffer1.y + shiftBy);
        };
        VList.prototype.indexPositionRelativeToBuffers = function (index, length) {
            if (length === void 0) { length = index; }
            var end = index + (length - 1);
            var bbegin = Math.min(this.buffer0.renderStartIndex, this.buffer1.renderStartIndex);
            if (end < bbegin) {
                return 0;
            }
            var bend = Math.min(this.buffer0.renderStartIndex + this.buffer0.renderLength, this.buffer1.renderStartIndex) + this.buffer1.renderLength;
            if (index > bend) {
                return 1;
            }
            return 2;
        };
        VList.prototype.render = function (forceRefresh) {
            var pos = this.data.container.parentElement.scrollTop;
            if (pos > this.bufferHeight && (this.length * this.data.elementHeight > this.bufferHeight)) {
                pos = Math.min(pos, this.length * this.data.elementHeight - this.bufferHeight);
            }
            var displayBuffer = Math.floor(pos / this.bufferHeight) % 2;
            var bufferStartPosition = pos - (pos % this.bufferHeight);
            var bufferStartElement = Math.floor(bufferStartPosition / this.data.elementHeight);
            var cb;
            var ob;
            if (displayBuffer == 0) {
                cb = this.buffer0;
                ob = this.buffer1;
            }
            else {
                cb = this.buffer1;
                ob = this.buffer0;
            }
            if (cb.renderStartIndex !== bufferStartElement || forceRefresh) {
                cb.prevRenderStartIndex = cb.renderStartIndex;
                cb.renderStartIndex = bufferStartElement;
                cb.moveTo(bufferStartPosition);
                this.renderBuffer(cb);
            }
            var a;
            if (pos > (bufferStartPosition + this.bufferHeight / 2)) {
                var _s = Math.min(this.length - 1, cb.renderStartIndex + cb.renderLength);
                if (ob.renderStartIndex !== _s || forceRefresh) {
                    ob.prevRenderStartIndex = ob.renderStartIndex;
                    ob.renderStartIndex = _s;
                    ob.moveTo(cb.y + this.bufferHeight);
                    this.renderBuffer(ob);
                }
            }
            else {
                var _s = Math.max(0, cb.renderStartIndex - cb.renderLength);
                if (ob.renderStartIndex !== _s || forceRefresh) {
                    ob.prevRenderStartIndex = ob.renderStartIndex;
                    ob.renderStartIndex = _s;
                    ob.moveTo(cb.y - this.bufferHeight);
                    this.renderBuffer(ob, cb.renderStartIndex);
                }
            }
        };
        VList.prototype.createTemplateElement = function () {
            this.elementCreator.innerHTML = "";
            this.elementCreator.innerHTML = this.data.template;
            var element = this.elementCreator.firstElementChild;
            var templateInfo = {};
            for (var key in this.templateBindingInfo) {
                var searchArr = this.templateBindingInfo[key];
                var node = this.elementCreator;
                for (var curIdx = 0; curIdx < searchArr.length; curIdx++) {
                    node = node.children[searchArr[curIdx]];
                }
                templateInfo[key] = node;
            }
            this.elementCreator.innerHTML = "";
            return {
                element: element,
                templateInfo: templateInfo
            };
        };
        VList.prototype.renderBuffer = function (buffer, renderTo) {
            if (renderTo === void 0) { renderTo = Number.POSITIVE_INFINITY; }
            var r = 0, pidx = buffer.prevRenderStartIndex, idx = buffer.renderStartIndex, length = buffer.renderLength;
            buffer.container.innerHTML = "";
            for (; r < length && idx < this.length && idx < renderTo; r++, idx++, pidx++) {
                if (this.templateMode) {
                    var el = buffer.elements[r];
                    var info = void 0;
                    if (el) {
                        info = buffer.elementTemplates[r];
                    }
                    else {
                        var elInfo = this.createTemplateElement();
                        el = elInfo.element;
                        info = elInfo.templateInfo;
                        info["$root"] = el;
                        buffer.elements[r] = el;
                        buffer.elementTemplates[r] = info;
                        if (this.data.onCreateElement) {
                            this.data.onCreateElement(idx, el);
                        }
                    }
                    this.data.templateRender(idx, info);
                    buffer.container.appendChild(el);
                }
                else {
                    var old = buffer.elements[r];
                    var el = this.data.render(idx, old, pidx);
                    if (old !== el) {
                        this.data.onCreateElement(idx, el);
                    }
                    buffer.container.appendChild(el);
                    buffer.elements[r] = el;
                }
            }
        };
        Object.defineProperty(VList.prototype, "length", {
            get: function () { return this._length; },
            set: function (v) { this._length = v; this.setContainerHeight(); },
            enumerable: true,
            configurable: true
        });
        return VList;
    }());
    function init(options) {
        return new VList(options);
    }
    VList_1.init = init;
})(VList || (VList = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmxpc3QubWluLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vbGliL3ZsaXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQU8sS0FBSyxDQTBXWDtBQTFXRCxXQUFPLE9BQUssRUFBQyxDQUFDO0lBY2I7UUFBQTtRQU9BLENBQUM7UUFBRCxnQkFBQztJQUFELENBQUMsQUFQRCxJQU9DO0lBRUQ7UUE0Q0MscUJBQW1CLEdBQWU7WUFBdEIsbUJBQXNCLEdBQXRCLE9BQXNCO1lBQWYsUUFBRyxHQUFILEdBQUcsQ0FBWTtZQXRCbEMscUJBQWdCLEdBQVcsQ0FBQyxDQUFDO1lBVTdCLGFBQVEsR0FBa0IsRUFBRSxDQUFDO1lBYTVCLElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMvQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDO1lBQ2xDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7UUFDcEMsQ0FBQztRQUVNLDRCQUFNLEdBQWIsVUFBYyxDQUFTO1lBQ3RCLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ1gsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLGlCQUFjLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxTQUFLLENBQUM7UUFDbEUsQ0FBQztRQUVNLHFDQUFlLEdBQXRCLFVBQXVCLENBQVM7WUFDL0IsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUM7WUFDdEIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDOUIsSUFBSSxHQUFHLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztnQkFDeEMsR0FBRyxDQUFBLENB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